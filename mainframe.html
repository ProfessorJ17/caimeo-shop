<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Caimeo</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
    }
    body {
      background: linear-gradient(135deg, #6B48FF 0%, #1A0033 100%), url('https://via.placeholder.com/1920x1080') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 20px;
      width: 90vw;
      max-width: 600px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(107, 72, 255, 0.5);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 2;
    }
    h1 {
      color: #fff;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 165, 0, 0.8);
    }
    p.subtitle {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.2em;
      margin-bottom: 20px;
      text-shadow: 0 0 5px rgba(107, 72, 255, 0.5);
    }
    p {
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 0 5px rgba(107, 72, 255, 0.5);
      margin: 10px 0;
    }
    input {
      margin-bottom: 15px;
      padding: 12px;
      width: 100%;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      color: white;
      font-size: 1em;
      outline: none;
      transition: all 0.3s ease;
    }
    input:focus {
      box-shadow: 0 0 15px rgba(255, 165, 0, 0.7);
      border-color: #FFA500;
    }
    button {
      padding: 12px;
      width: 100%;
      background: linear-gradient(90deg, #FFA500 0%, #FF4500 100%);
      border: none;
      border-radius: 25px;
      color: #fff;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
    }
    button:hover {
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.8);
      transform: translateY(-2px);
    }
    #error-message {
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 0 5px rgba(107, 72, 255, 0.5);
      margin-top: 10px;
      display: none;
    }
    ::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    .hidden {
      display: none;
    }
    #logout-btn {
      width: 50%;
      margin: 20px auto 0;
    }
    #custom-content {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="login-section">
      <h1>Caimeo</h1>
      <p class="subtitle">Empowering the Future with Intelligence</p>
      <input id="email" type="email" placeholder="Email" required>
      <input id="password" type="password" placeholder="Password" required>
      <button id="submit">Sign In</button>
      <p id="error-message"></p>
    </div>
    <div id="dashboard-section" class="hidden">
      <h1>Caimeo</h1>
      <p class="subtitle">Welcome <span id="username"></span>!</p>
      <p>Subscription Status: <span id="purchase-status"></span></p>
      <button id="logout-btn">Logout</button>
    </div>
  </div>

  <div id="custom-content" class="hidden">
    <!-- Add custom HTML here -->
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

  <script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('keydown', event => {
      if (event.ctrlKey && (event.key === 'u' || event.key === 'U' ||
          event.key === 's' || event.key === 'S' ||
          event.key === 'j' || event.key === 'J' ||
          event.key === 'i' || event.key === 'I' ||
          event.key === 'c' || event.key === 'C' ||
          event.key === 'k' || event.key === 'K')) {
        event.preventDefault();
      }
    });

    const firebaseConfig = {
      apiKey: "AIzaSyDYXyAmDC_HF4scI21VeLlS4aM2k2RJ1Wc",
      authDomain: "mainframe-e3b13.firebaseapp.com",
      projectId: "mainframe-e3b13",
      storageBucket: "mainframe-e3b13.firebasestorage.app",
      messagingSenderId: "85561924382",
      appId: "1:85561924382:web:5d5eddda04a466ec56870f",
      measurementId: "G-N2Q017PZXB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginSection = document.getElementById('login-section');
    const dashboardSection = document.getElementById('dashboard-section');
    const customContent = document.getElementById('custom-content');
    const submitButton = document.getElementById('submit');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const errorMessage = document.getElementById('error-message');
    const usernameDisplay = document.getElementById('username');
    const purchaseStatusDisplay = document.getElementById('purchase-status');
    const logoutBtn = document.getElementById('logout-btn');

    async function getUserData(user) {
      try {
        alert('Fetching data for: ' + user.email);
        const userDocRef = db.collection('allowedEmails').doc(user.email.toLowerCase());
        const userDoc = await userDocRef.get();
        let userData;
        if (userDoc.exists) {
          userData = userDoc.data();
        } else {
          userData = {
            date: new Date().toLocaleDateString('en-CA'),
            email: user.email,
            name: user.email.split('@')[0],
            purchased: true,
            uid: user.uid
          };
          await userDocRef.set(userData);
        }
        return userData;
      } catch (error) {
        alert('Firestore error: ' + error.message);
        throw error;
      }
    }

    function showLogin() {
      loginSection.classList.remove('hidden');
      dashboardSection.classList.add('hidden');
      customContent.classList.add('hidden');
      emailInput.value = '';
      passwordInput.value = '';
      errorMessage.style.display = 'none';
    }

    function showDashboard(userData) {
      loginSection.classList.add('hidden');
      dashboardSection.classList.remove('hidden');
      customContent.classList.add('hidden');
      usernameDisplay.textContent = userData.name;
      purchaseStatusDisplay.textContent = userData.purchased ? 'Active' : 'Inactive';
    }

    submitButton.addEventListener('click', async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      try {
        alert('Attempting login for: ' + email);
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const userData = await getUserData(user);
        sessionStorage.setItem('userData', JSON.stringify(userData));
        showDashboard(userData);
      } catch (error) {
        errorMessage.style.display = 'block';
        errorMessage.textContent = error.message;
        alert('Login error: ' + error.message);
      }
    });

    logoutBtn.addEventListener('click', async () => {
      sessionStorage.removeItem('userData');
      await auth.signOut();
      showLogin();
    });

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        alert('User authenticated: ' + user.email);
        try {
          const userData = await getUserData(user);
          sessionStorage.setItem('userData', JSON.stringify(userData));
          showDashboard(userData);
        } catch (error) {
          alert('Error loading dashboard: ' + error.message);
          showLogin();
        }
      } else {
        showLogin();
      }
    });
  </script>
</body>
</html>
